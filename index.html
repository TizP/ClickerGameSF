<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Pipeline Simulator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="resources/img/favicon.ico">

</head>
<body>
    <!-- Audio Elements -->
    <audio id="background-music" loop preload="auto">
        Your browser does not support the audio element.
    </audio>
    <audio id="sfx-purchase" preload="auto">
        <source src="resources/audio/sfx/cash-register-kaching-sound-effect-125042.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio id="sfx-powerup-click" preload="auto">
        <source src="resources/audio/sfx/collect-5930.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>


    <div class="game-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="music-player">
                 <p class="track-info" title="Current background music track">Now Playing: <span id="current-track-name">Track Name</span></p>
                 <div class="music-controls">
                    <button id="play-pause-button" title="Play/Pause Music"><span id="play-pause-icon">‚ñ∫</span></button>
                    <button id="next-track-button" title="Next Track"><span>‚è≠</span></button>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.1" title="Adjust Music & SFX Volume">
                    <button id="mute-button" class="mute-button" title="Mute/Unmute All Audio">üîá</button>
                </div>
            </div>
            <div class="top-bar-center-status">
                <div id="active-powerup-display" title="Currently active power-up and its effect"></div>
                 <p id="save-status" class="save-status-text" title="Indicates save status"></p>
            </div>
            <div class="top-bar-buttons">
                <button id="toggle-acquisition-button" class="simple-button pause-acq-button" title="Pause/Resume automatic spending of Leads/Opps on customer acquisition attempts">Pause Acq</button>
                <button id="save-button" class="simple-button save-button" title="Save progress manually">Save Game</button>
                <button id="delete-save-button" class="simple-button delete-button" title="Delete saved progress (requires confirmation)">Delete Save</button>
                <button id="settings-button" class="simple-button" title="Game Settings">Settings</button>
                <button id="stats-button" class="simple-button" title="Show detailed game statistics">Show Stats</button>
                <button id="tutorial-button" class="simple-button" title="Show game tutorial and explanation">Tutorial</button>
                <button id="credits-button" class="simple-button" title="Show game credits and attributions">Credits</button>
                <span id="game-version" title="Current Game Version">v?.??</span>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content-area">
            <!-- Left Panel (Upgrades) -->
            <div class="side-panel upgrades-panel">
                <div class="panel-sticky-title">Upgrades & Training</div>

                 <!-- Tiered Upgrade Categories -->
                 <h4 class="group-title">Manual Generation <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-manualGen" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Lead Team Boosts <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-leadTeamBoosts" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Opportunity Team Boosts <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-oppTeamBoosts" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Integrated Solution Boosts <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-integratedBoosts" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Pipeline Efficiency <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-pipelineEfficiency" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Acquisition Enhancement <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-acquisitionEnhancement" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Acquisition Cost Reduction <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-acquisitionCost" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Customer Value Rate <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-customerValue" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Customer Driven Growth <span class="toggle-icon"></span></h4>
                 <div id="upgrade-category-customerGrowth" class="upgrade-category-container"></div>
                 <hr class="side-panel-hr">

                 <!-- Special Upgrades Section -->
                 <h4 class="group-title">Special Upgrades <span class="toggle-icon"></span></h4>
                 <div class="upgrade-category-container"> <!-- Wrap specials for consistency -->
                     <button id="upgrade-costReductStrategic" class="upgrade-button" disabled title="Re-engineers the acquisition process for a massive reduction in cost per attempt (-33% multiplicative).">
                        <span>Strategic Cost Optimization</span> <span class="cost">Cost: $5M</span> <span class="effect">-33% Acq. Cost</span>
                     </button>
                     <button id="upgrade-playtimeMPSBoost" class="upgrade-button" disabled title="Increases MPS by +100% per hour played (capped at +200% after 2 hours). Requires significant playtime to reach max effect.">
                         <span>Veteran Pipeline Operator</span> <span class="cost">Req: 1k Cust & $10M</span> <span class="effect">+MPS based on Playtime</span>
                     </button>
                     <button id="upgrade-flexibleWorkflow" class="upgrade-button" disabled title="Purchase to unlock the Flexible Workflow toggle. Balances L/O amounts by shifting generation focus.">
                        <span>Flexible Workflow</span> <span class="cost">Req: 100 Cust & $10k</span> <span class="effect">Enables Workflow Toggle</span>
                     </button>
                     <button id="toggle-flexible-workflow" class="simple-button" disabled title="Purchase the Flexible Workflow upgrade first to enable toggling.">
                         Activate Flex Workflow
                     </button>
                 </div>
            </div> <!-- End Upgrades Panel -->

            <!-- Center Area -->
             <div class="center-area">
                <h1>Salesforce Pipeline Simulator</h1>
                <div class="stats-display">
                    <p title="Raw potential for opportunities.">Leads: <span id="leads">0</span></p>
                    <p title="Qualified potential ready for sales engagement.">Opportunities: <span id="opportunities">0</span></p>
                    <p title="Acquired clients generating revenue.">Customers: <span id="customers">0</span></p>
                    <p class="money-display" title="Total accumulated wealth!">Money: <span id="money">$0.00</span></p>
                    <hr class="stats-hr">
                    <p title="Rate at which Leads are generated automatically.">Leads/Second: <span id="lps">0 L/s</span></p>
                    <p title="Rate at which Opportunities are generated automatically.">Opportunities/Second: <span id="ops">0 O/s</span></p>
                    <p title="Rate at which Money is generated by Customers.">Money/Second: <span id="mps">$0.00/s</span></p>
                    <hr class="stats-hr">
                    <p id="lead-click-base-p" title="Effective Lead generation per click (Base + Bonus % + Power-ups)">Leads/Click: <span id="leads-per-click">1</span></p>
                    <p id="opp-click-base-p" title="Effective Opportunity generation per click (Base + Bonus % + Power-ups)">Opps/Click: <span id="opps-per-click">1</span></p>
                    <hr class="stats-hr">
                    <p title="Attempts per second to convert Lead/Opportunity pairs into a Customer">Acquisition Rate (/s): <span id="car">0.100</span></p>
                    <p title="Chance for an acquisition attempt to succeed">Acquisition Success (%): <span id="success-chance">25.0%</span></p>
                    <p title="Current cost per new Customer attempt (equal Leads & Opportunities)">Acquisition Cost (L&O): <span id="cust-cost">100</span></p>
                    <hr class="stats-hr">
                    <p title="Money generated per Customer per second">Customer Value Rate ($/Cust/s): <span id="cvr">1.000</span></p>
                </div>
                <div class="click-zone">
                    <button id="click-lead-button" title="Generate Lead! Click, click, click!"><img src="resources/img/lead.jpeg" alt="Generate Lead"></button>
                    <button id="click-opp-button" title="Generate Opportunity! Turn potential into reality!"><img src="resources/img/opportunity.jpeg" alt="Generate Opportunity"></button>
                </div>
            </div>
            <!-- End Center Area -->

            <!-- Right Panel (Buildables) -->
             <div class="side-panel buildables-panel">
                <div class="panel-sticky-title">Teams & Features</div>
                 <!-- Build Categories -->
                 <h4 class="group-title">Lead Generation Teams <span class="toggle-icon"></span></h4>
                 <div class="build-category-container">
                     <button id="buy-sdr" class="build-button" disabled title="..."> <span class="build-title">SDR (<span class="count" id="sdr-count">0</span>)</span> <span class="effect" id="sdr-effect">...</span> <span class="cost" id="sdr-cost">...</span> </button>
                     <button id="buy-webform" class="build-button" disabled title="..."> <span class="build-title">Web Form (<span class="count" id="webform-count">0</span>)</span> <span class="effect" id="webform-effect">...</span> <span class="cost" id="webform-cost">...</span> </button>
                     <button id="buy-pardot" class="build-button" disabled title="..."> <span class="build-title">Pardot Campaign (<span class="count" id="pardot-count">0</span>)</span> <span class="effect" id="pardot-effect">...</span> <span class="cost" id="pardot-cost">...</span> </button>
                     <button id="buy-nurture" class="build-button" disabled title="..."> <span class="build-title">Nurture Program (<span class="count" id="nurture-count">0</span>)</span> <span class="effect" id="nurture-effect">...</span> <span class="cost" id="nurture-cost">...</span> </button>
                     <button id="buy-marketingcloud" class="build-button" disabled title="..."> <span class="build-title">Mkt Cloud Journey (<span class="count" id="marketingcloud-count">0</span>)</span> <span class="effect" id="marketingcloud-effect">...</span> <span class="cost" id="marketingcloud-cost">...</span> </button>
                 </div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Opportunity Generation Teams <span class="toggle-icon"></span></h4>
                 <div class="build-category-container">
                      <button id="buy-bdr" class="build-button" disabled title="..."> <span class="build-title">BDR (<span class="count" id="bdr-count">0</span>)</span> <span class="effect" id="bdr-effect">...</span> <span class="cost" id="bdr-cost">...</span> </button>
                     <button id="buy-qualbot" class="build-button" disabled title="..."> <span class="build-title">Qual Bot (<span class="count" id="qualbot-count">0</span>)</span> <span class="effect" id="qualbot-effect">...</span> <span class="cost" id="qualbot-cost">...</span> </button>
                     <button id="buy-solutionengineer" class="build-button" disabled title="..."> <span class="build-title">Solution Engineer (<span class="count" id="solutionengineer-count">0</span>)</span> <span class="effect" id="solutionengineer-effect">...</span> <span class="cost" id="solutionengineer-cost">...</span> </button>
                     <button id="buy-demospec" class="build-button" disabled title="..."> <span class="build-title">Demo Specialist (<span class="count" id="demospec-count">0</span>)</span> <span class="effect" id="demospec-effect">...</span> <span class="cost" id="demospec-cost">...</span> </button>
                     <button id="buy-proposaldesk" class="build-button" disabled title="..."> <span class="build-title">Proposal Desk (<span class="count" id="proposaldesk-count">0</span>)</span> <span class="effect" id="proposaldesk-effect">...</span> <span class="cost" id="proposaldesk-cost">...</span> </button>
                 </div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Integrated Solutions <span class="toggle-icon"></span></h4>
                 <div class="build-category-container">
                     <button id="buy-integration" class="build-button" disabled title="..."> <span class="build-title">Integration Hub (<span class="count" id="integration-count">0</span>)</span> <span class="effect" id="integration-effect">...</span> <span class="cost" id="integration-cost">...</span> </button>
                     <button id="buy-platform" class="build-button" disabled title="..."> <span class="build-title">Platform App (<span class="count" id="platform-count">0</span>)</span> <span class="effect" id="platform-effect">...</span> <span class="cost" id="platform-cost">...</span> </button>
                     <button id="buy-ecosystem" class="build-button" disabled title="..."> <span class="build-title">Partner Ecosystem (<span class="count" id="ecosystem-count">0</span>)</span> <span class="effect" id="ecosystem-effect">...</span> <span class="cost" id="ecosystem-cost">...</span> </button>
                     <button id="buy-cloudsuite" class="build-button" disabled title="..."> <span class="build-title">Cloud Suite (<span class="count" id="cloudsuite-count">0</span>)</span> <span class="effect" id="cloudsuite-effect">...</span> <span class="cost" id="cloudsuite-cost">...</span> </button>
                     <button id="buy-hyperscaler" class="build-button" disabled title="..."> <span class="build-title">Hyperscaler (<span class="count" id="hyperscaler-count">0</span>)</span> <span class="effect" id="hyperscaler-effect">...</span> <span class="cost" id="hyperscaler-cost">...</span> </button>
                     <button id="buy-aidata" class="build-button" disabled title="..."> <span class="build-title">AI Data Cloud (<span class="count" id="aidata-count">0</span>)</span> <span class="effect" id="aidata-effect">...</span> <span class="cost" id="aidata-cost">...</span> </button>
                 </div>
                 <hr class="side-panel-hr">
                 <h4 class="group-title">Customer Success <span class="toggle-icon"></span></h4>
                 <div class="build-category-container">
                     <button id="buy-acctManager" class="build-button" disabled title="..."> <span class="build-title">Acct Manager (<span class="count" id="acctManager-count">0</span>)</span> <span class="effect" id="acctManager-effect">...</span> <span class="cost" id="acctManager-cost">...</span> </button>
                     <button id="buy-successArchitect" class="build-button" disabled title="..."> <span class="build-title">Success Architect (<span class="count" id="successArchitect-count">0</span>)</span> <span class="effect" id="successArchitect-effect">...</span> <span class="cost" id="successArchitect-cost">...</span> </button>
                     <button id="buy-procurementOpt" class="build-button" disabled title="..."> <span class="build-title">Procurement Opt. (<span class="count" id="procurementOpt-count">0</span>)</span> <span class="effect" id="procurementOpt-effect">...</span> <span class="cost" id="procurementOpt-cost">...</span> </button>
                     <!-- TODO: Added Success Manager Button -->
                     <button id="buy-successManager" class="build-button" disabled title="..."> <span class="build-title">Success Manager (<span class="count" id="successManager-count">0</span>)</span> <span class="effect" id="successManager-effect">...</span> <span class="cost" id="successManager-cost">...</span> </button>
                 </div>
                 <hr class="side-panel-hr">
            </div> <!-- End Buildables Panel -->
        </div> <!-- End main-content-area -->

        <!-- Powerup Spawn Area -->
        <div id="powerup-spawn-area"></div>

    </div> <!-- End game-container -->

    <!-- Modals -->
    <div id="credits-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-credits-button" title="Close">√ó</span>
            <h2>Credits</h2>
            <p><strong>Game Design & Development:</strong></p>
            <ul><li>Tizp</li><li>AI Assistant (Gemini)</li></ul>
            <p><strong>Music:</strong></p>
            <p>"Batty McFaddin - Slower"<br> "Pixelland"<br> "Disco con Tutti"<br> "Fox Tale Waltz Part 1 Instrumental"<br> "Mining by Moonlight"<br> "Space Jazz"<br> "Surf Shimmy"<br> <br> All music by Kevin MacLeod (incompetech.com)<br> Licensed under Creative Commons: By Attribution 4.0 License<br> <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">http://creativecommons.org/licenses/by/4.0/</a></p>
            <p><strong>Sound Effects:</strong></p> <p>"Cash Register Kaching" by Modestas123123 from Pixabay</p>
            <p>"Collect Point" (collect-5930.mp3) by freesound_community from Pixabay</p>
            <p><strong>Images:</strong></p>
            <p>Lead/Opportunity Button Images Generated by Gemini</p>
            <p>Favicon & Power-up Images: Various memes found online</p>
            <p><i>Game concept inspired by Cookie Clicker and other incremental games.</i></p>
        </div>
    </div>

    <div id="win-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-win-button" title="Close">√ó</span> <!-- Changed ID -->
            <h2>Congratulations!</h2>
            <p>You've built a pipeline generating over <strong>$1 Billion!</strong></p>
            <p>You are a true Salesforce Pipeline Master!</p>
            <p>(Game Paused)</p>
            <button id="close-win-modal-button" class="simple-button">Keep Playing</button> <!-- Changed ID -->
        </div>
    </div>


    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-stats-button" title="Close">√ó</span>
            <h2>Statistics</h2>
            <div class="stats-list">
                <p>Game Time: <span id="stat-game-time">0s</span></p> <hr>
                <p>Lead Clicks: <span id="stat-lead-clicks">0</span></p>
                <p>Opportunity Clicks: <span id="stat-opp-clicks">0</span></p>
                <p>Manual Leads: <span id="stat-manual-leads">0</span></p>
                <p>Manual Opportunities: <span id="stat-manual-opps">0</span></p> <hr>
                <p>Auto Leads Generated: <span id="stat-auto-leads">0</span></p>
                <p>Auto Opportunities Generated: <span id="stat-auto-opps">0</span></p> <hr>
                <p>Acquisition Attempts: <span id="stat-acq-attempts">0</span></p>
                <p>Successful Acquisitions: <span id="stat-acq-success">0</span></p>
                <p>Failed Acquisitions: <span id="stat-acq-failed">0</span></p> <hr>
                <p>Power-ups Clicked: <span id="stat-powerups-clicked">0</span></p> <hr>
                <p>Total Money Earned: $<span id="stat-total-money">0.00</span></p>
            </div>
        </div>
    </div>

    <div id="tutorial-modal" class="modal">
        <div class="modal-content">
             <span class="close-button" id="close-tutorial-button" title="Close">√ó</span>
             <h2>Tutorial: How to Play</h2>
             <p>Welcome to the <strong>Salesforce Pipeline Simulator!</strong> Your goal is to build a massive sales pipeline and reach <strong>$1 Billion</strong> in revenue.</p>
             <h4>Core Resources:</h4>
             <ul>
                <li><strong>Leads (L):</strong> Raw potential. Generated via clicks or Teams/Features. Spent on upgrades, Teams/Features, & Acquisition.</li>
                <li><strong>Opportunities (Opps/O):</strong> Qualified potential. Generated via clicks or Teams/Features. Spent on upgrades, Teams/Features, & Acquisition.</li>
                <li><strong>Customers (Cust):</strong> Source of revenue! Acquired by spending L & O. Required (not spent) for 'Customer Driven Growth' upgrades.</li>
                <li><strong>Money ($):</strong> Your score! Generated by Customers. Spent on efficiency upgrades & Customer Success buildings.</li>
             </ul>
             <h4>Generating Resources:</h4>
             <ul>
                <li><strong>Manual Clicks:</strong> Click Lead/Opp buttons in center. Upgrades boost amount/click.</li>
                <li><strong>Teams & Features (Right Panel):</strong> Buy items to generate L/S or O/S automatically. Costs increase per purchase. Shift+Click to buy 10.</li>
             </ul>
             <h4>Getting Customers (Acquisition):</h4>
             <ul>
                <li>Game automatically attempts to convert L & O into Customers.</li>
                <li><strong>Acquisition Cost:</strong> L & O cost per attempt (shown in center stats). Increases with Customers, reducible by upgrades and buildings (e.g., Acct Managers).</li>
                <li><strong>Acquisition Rate (CAR):</strong> Attempts/second. Increase via upgrades.</li>
                <li><strong>Acquisition Success:</strong> % chance an attempt succeeds. Increase via upgrades. Failure still costs L & O!</li>
                <li><strong>Pause Acquisition:</strong> Top bar button pauses L/O consumption for attempts.</li>
             </ul>
             <h4>Generating Money:</h4>
             <ul>
                <li>Each Customer generates $/sec based on <strong>Customer Value Rate (CVR)</strong>.</li>
                <li>Increase CVR via upgrades and buildings (e.g., Success Architects, Success Managers).</li>
             </ul>
             <h4>Upgrades & Training (Left Panel):</h4>
             <ul>
                 <li>Spend L, O, $, or meet Customer requirements for upgrades to:
                     <ul>
                         <li>Boost manual clicks.</li>
                         <li>Boost Team/Feature output (multipliers, percentages, synergies).</li>
                         <li>Improve overall efficiency.</li>
                         <li>Improve Acquisition Rate (CAR), Success %, or reduce Cost.</li>
                         <li>Increase Customer Value Rate (CVR).</li>
                         <li>Purchase special upgrades (e.g., Flexible Workflow, Veteran Pipeline Operator).</li>
                         <li>Gain bonuses by meeting Customer thresholds for 'Customer Driven Growth' upgrades.</li>
                     </ul>
                 </li>
                 <li><strong>Tiered Upgrades:</strong> Purchase all Tier 1 upgrades in a category to unlock powerful Tier 2 upgrades.</li>
                 <li><strong>Collapsible Categories:</strong> Click the [-] / [+] on category titles to hide/show their contents.</li>
            </ul>
             <h4>Teams & Features (Right Panel):</h4>
             <ul>
                <li>Purchase buildings for passive L/S, O/S, or other effects.</li>
                <li><strong>Customer Success Buildings:</strong> Provide unique bonuses like reducing Acquisition Cost (Acct Manager), boosting CVR based on other buildings (Success Architect), reducing the cost of other buildings (Procurement Opt.), or directly boosting CVR (Success Manager).</li>
                <li><strong>Collapsible Categories:</strong> Click the [-] / [+] on category titles to hide/show their contents.</li>
            </ul>
             <h4>Special Upgrades:</h4>
             <ul>
                <li><strong>Flexible Workflow:</strong> Purchase to unlock a toggle button. When active, reduces the generation rate of the resource you currently have *more* of (L or O) by 50%, and adds that generation rate to the resource you have *less* of. Aims to balance the *total amounts* of Leads and Opportunities. Deactivates automatically when amounts become roughly equal.</li>
                <li><strong>Veteran Pipeline Operator:</strong> Increases your Money per Second based on total playtime. The bonus starts at 0% and increases by +100% MPS per hour played, capping at a maximum of +200% bonus after 2 hours of playtime.</li>
            </ul>
             <h4>Power-ups (Falling Tokens):</h4>
             <ul>
                 <li>Occasionally (check often!), circular tokens will fall from the top of the screen.</li>
                <li>Click a token before it disappears off the bottom to activate a temporary boost!</li>
                <li>Possible boosts include increased L/S & O/S, more powerful clicks, increased M/S, or higher CVR.</li>
            </ul>
             <h4>Goal & Saving:</h4>
             <ul>
                 <li>Reach <strong>$1 Billion</strong>!</li>
                 <li>Auto-saves every 30 seconds. Use top bar buttons for manual save/delete.</li>
             </ul>
             <p>Good luck!</p>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-settings-button" title="Close">√ó</span>
            <h2>Settings</h2>
            <div class="settings-content">
                 <p>Game controls and options.</p>
                 <hr style="margin: 15px 0;">
                 <button id="soft-refresh-button" class="simple-button" title="Reloads the game state from the last save and restarts intervals. Useful if UI seems stuck. Does NOT clear progress.">
                     Soft Refresh Game
                 </button>
                 <p style="font-size: 0.8em; color: #666; margin-top: 5px;">
                     (Reloads from last save - any unsaved progress might be lost)
                 </p>
            </div>
        </div>
    </div>

    <!-- Load main script as module -->
    <script type="module" src="js/main.js" defer></script>
</body>
</html>